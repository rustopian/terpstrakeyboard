<!DOCTYPE html>

<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Temper</title>

	<meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, target-densitydpi=device-dpi">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="author" content="James Fenn">

	<link rel="stylesheet" href="/styles/normalize.css">
	<link rel="stylesheet" href="/styles/skeleton.css">
	<link rel="stylesheet" href="/styles/terpstra-style.css">
    
    <link rel="manifest" href="/manifest.webmanifest"> <!-- added to enable Android Firefox users to add the web app to the home screen -->

    <!-- Add Noto Sans Symbols fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Symbols&family=Noto+Sans+Symbols+2&display=swap" rel="stylesheet">

    <!-- Update font stack in style -->
    <style>
        @font-face {
            font-family: 'Ekmelos';
            src: url('/fonts/Ekmelos.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: block;
        }
        
        /* Custom dropdown styling */
        .custom-select-wrapper {
            position: relative;
            width: 100%;
        }

        .custom-select, .custom-select-option {
            position: relative;
            background-color: white;
            border: 1px solid #D1D1D1;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
        }

        /* Style for the musical symbols specifically */
        .notation-symbols {
            font-family: 'Ekmelos', sans-serif !important;
            display: inline-block;
            margin-left: 8px;
        }

        .custom-select-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #D1D1D1;
            border-top: none;
            border-radius: 0 0 4px 4px;
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }

        .custom-select-option {
            padding: 8px 12px;
            cursor: pointer;
            font-family: 'Ekmelos', sans-serif !important;
            font-size: 18px;
        }

        .custom-select-option:hover {
            background-color: #f0f0f0;
        }

        .custom-select-option.selected {
            background-color: #e0e0e0;
        }

        /* Hide the original select */
        #notation-system {
            display: none;
        }
    </style>

    <!-- Preload fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Symbols&family=Noto+Sans+Symbols+2&display=swap" as="style">

    <!-- Preload the Ekmelos font -->
    <link rel="preload" href="/fonts/Ekmelos.woff" as="font" type="font/woff" crossorigin>

	<script src="/src/jscolor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/webmidi@latest/dist/iife/webmidi.iife.min.js"></script>
	<script type="module" src="/src/keys.ts"></script>
</head>

<body style="overflow: scroll;">
	<div class="modal-overlay"></div>
	<div class="scroll-area"></div>
	
	<div id="landing-page" class="section modal">
		<div class="container">
		  <h2>Temper</h2>
		  <div class="row">
              <img alt="" src="images/1x1.png">
          </div>

			<form id="settingsForm">
				<div class="tabs">
					<button type="button" class="tab-button active" data-tab="audio">Audio</button>
					<button type="button" class="tab-button" data-tab="layout">Layout & Display</button>
					<button type="button" class="tab-button" data-tab="advanced">Advanced</button>
					<button type="button" class="tab-button" data-tab="credits">Credits</button>
					<button type="button" class="tab-button" data-tab="learning">Learning</button>
				</div>

				<!-- Audio Tab -->
				<div id="audio" class="tab-content active">
					<div class="row">
						<div class="one-half column">
							<label>Tuning\Layout Quick Links</label>
							<select id="quicklinks" class="u-full-width">
								<option selected="selected" disabled="disabled">Choose Preset</option>
							</select>

							<div class="pitch-input-group">
								<label>Reference Pitch</label>
								<div class="pitch-controls">
									<select id="pitch-type" class="u-half-width" onchange="window.settingsManager.handlePitchTypeChange();">
										<option value="fundamental">C4 (Hz)</option>
										<option value="A4">A4 (Hz)</option>
									</select>
									<input id="fundamental" type="number" step="any" min="0.015625" max="16384" onchange="window.settingsManager.handleFundamentalChange();changeURL();noPreset();" class="u-half-width">
								</div>
							</div>

							<label>Octave Offset</label>
							<input type="range" id="central-octave" min="-2" max="5" value="0" class="u-full-width">
							<div class="range-labels" style="display: flex; justify-content: space-between; margin: 0 -2%;">
								<span>-2</span>
								<span>-1</span>
								<span>0</span>
								<span>1</span>
								<span>2</span>
								<span>3</span>
								<span>4</span>
								<span>5</span>
							</div>
						</div>
						
						<div class="one-half column">
							<label>Instrument</label>
							<select id="instrument" onchange="changeURL();noPreset();" class="u-full-width">
								<optgroup label="Regular">
									<option value="piano">Piano</option>
									<option value="harpsichord">Harpsichord</option>
									<option value="rhodes">Rhodes</option>
									<option value="harp">Harp</option>
									<option value="choir">Choir</option>
									<option value="strings">Strings</option>
									<option value="sawtooth">Sawtooth</option>
									<option value="gayageum">Gayageum</option>
									<option value="qanun">Qanun</option>
									<option value="organ">Organ</option>
									<option value="organleslie">Organ + Leslie</option>
									<option value="marimba">Marimba</option>
									<option value="musicbox">Music Box</option>
								</optgroup>
								<optgroup label="«What Music Really İs» Study Tones">
									<option value="WMRI3LST">WMRİ 3-Limit (4 Harmonics) ST</option>
									<option value="WMRI5LST">WMRİ 5-Limit (6 Harmonics) ST</option>
									<option value="WMRI5Lpike">WMRİ 5-Limit (6 Harmonics) Pk</option>
									<option value="WMRI7LST">WMRİ 7-Limit (10 Harmonics) ST</option>
									<option value="WMRI11LST">WMRİ 11-Limit (12 Harmonics) ST</option>
									<option value="WMRI13LST">WMRİ 13-Limit (16 Harmonics) ST</option>
									<option value="WMRInLST">WMRİ n-Limit ("sawtooth wave") ST</option>
									<option value="WMRIByzantineST">WMRİ Byzantine (9 Harmonics) ST</option>
									<option value="WMRI-in6-har7-">WMRİ Stretch inharmonic 6 = harmonic 7</option>
									<option value="WMRI-in7-har6-">WMRİ Compress inharmonic 7 = harmonic 6</option>
								</optgroup>
							</select>

							<label>
								<input id="midi_input" type="checkbox" name="midi_input" value="fnord" onchange="changeURL();noPreset();">
								<span class="label-body">Control MIDI devices (WebMIDI Output)</span>
							</label>
							<label>
								<input id="toggle_mode" type="checkbox" name="toggle_mode" value="fnord" onchange="changeURL();noPreset();">
								<span class="label-body">Toggle Mode (Click/tap to hold notes)</span>
							</label>
							
							<div class="control-group">
								<label>
									<input id="tilt_volume_enabled" type="checkbox" name="tilt_volume_enabled" value="fnord" onchange="window.settingsManager.updateTiltVolume();">
									<span class="label-body">Enable Tilt Volume Control</span>
								</label>
								<select id="tilt_volume_axis" class="u-full-width" onchange="window.settingsManager.updateTiltVolume();" style="margin-top: 10px;">
									<option value="x">Front-to-Back Tilt (X-axis)</option>
									<option value="z">Left-to-Right Tilt (Z-axis)</option>
								</select>
								<button type="button" id="calibrate_tilt" class="button" onclick="window.settingsManager.calibrateTiltFromSensor();" style="margin-top: 10px;">
									Calibrate Current Tilt as Center
								</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Layout Tab -->
				<div id="layout" class="tab-content">
					<div class="row">
						<div class="one-half column">
							<div class="layout-controls">
								<label>Layout Settings</label>
								<div class="control-group">
									<label>Right Facing Steps</label>
									<input id="rSteps" type="number" min="-1220" max="1220" onchange="changeURL();noPreset();" class="u-full-width">
								</div>

								<div class="control-group">
									<label>Up/Right Facing Steps</label>
									<input id="urSteps" type="number" min="-1220" max="1220" onchange="changeURL();noPreset();" class="u-full-width">
								</div>

								<div class="control-group">
									<label>Hex Size (pixels)</label>
									<input id="hexSize" type="number" step="any" min="20" max="1000" onchange="changeURL();noPreset();" class="u-full-width">
								</div>

								<div class="control-group">
									<label>Rotation (degrees)</label>
									<input id="rotation" type="number" step="any" min="0" max="360" value="343.897886248" onchange="changeURL();noPreset();" class="u-full-width">
								</div>

								<div class="control-group">
									<label>
										<input id="infinite_rows" type="checkbox" name="infinite_rows" value="fnord" onchange="changeURL();noPreset();" checked>
										<span class="label-body">Infinite Rows</span>
									</label>
								</div>
							</div>
						</div>

						<div class="one-half column">
							<div class="display-controls">
								<label>Display Settings</label>
								<div class="control-group">
									<label>
										<input id="full-chord-notation" type="checkbox" name="symbolic_chord_notation" value="fnord" onchange="changeURL();noPreset();">
										<span class="label-body">Show Full Chord Names</span>
									</label>
								</div>

								<div class="control-group">
									<label>
										<input id="enum" type="checkbox" name="number_or_name" value="fnord" onchange="hideRevealNames();noPreset();">
										<span class="label-body">Use Numbers with Root Note:</span>
									</label>
								</div>
								<div class="control-group" id="number-root-container">
									<select id="number-root" class="u-full-width" onchange="window.settingsManager.updateKeyboardDisplay();changeURL();noPreset();">
										<!-- Note names will be populated dynamically -->
									</select>
								</div>

								<div class="control-group">
									<label>
										<input id="spectrum_colors" type="checkbox" name="spectrum_colors" value="fnord" onchange="hideRevealColors();noPreset();">
										<span class="label-body">Note Rainbow Mode</span>
									</label>
								</div>

								<div class="control-group">
									<label>
										<input id="no_labels" type="checkbox" name="blank_keys" value="fnord" onchange="hideRevealEnum();noPreset();">
										<span class="label-body">Blank Keys</span>
									</label>
								</div>

								<div class="control-group">
									<label>Color Vision Mode</label>
									<select id="color-vision-mode" class="u-full-width" onchange="updateColorVisionMode();">
										<option value="normal">Normal Vision</option>
										<option value="protanopia">Protanopia</option>
										<option value="deuteranopia">Deuteranopia</option>
										<option value="tritanopia">Tritanopia</option>
									</select>
								</div>

								<div class="control-group">
									<label>Notation System</label>
									<select id="notation-system" class="u-full-width" onchange="window.settingsManager.updateNotationSystem();">
										<option value="Standard">Standard (&#xE27A; &#xE27B; &#xE262; &#xE260;) [E27A E27B E262 E260]</option>
										<option value="Sagittal">Sagittal (&#xE30A; &#xE30B; &#xE318; &#xE319;) [E30A E30B E318 E319]</option>
										<option value="Mixed Sagittal">Mixed Sagittal (&#xE30A; &#xE30B; &#xE262; &#xE260;) [E30A E30B E262 E260]</option>
										<option value="Stein/Zimmermann">Stein/Zimmermann (&#xE282; &#xE284; &#xE262; &#xE260;) [E282 E284 E262 E260]</option>
										<option value="Stein/Half-Flat">Stein/Half-Flat (&#xE282; &#xF612; &#xE262; &#xE260;) [E282 F612 E262 E260]</option>
									</select>
								</div>

								<div class="control-group">
									<label>Color Saturation</label>
									<input type="range" id="color-saturation" class="u-full-width" min="0" max="100" value="100" onchange="updateColorSaturation();">
									<div class="range-labels">
										<span>0%</span>
										<span>50%</span>
										<span>100%</span>
									</div>
								</div>

								<div class="control-group">
									<label>
										<input id="invert-updown" type="checkbox" name="invert_updown" value="fnord" onchange="updateKeyboardDisplay();">
										<span class="label-body">Invert Up/Down Colors</span>
									</label>
								</div>

								<div id="note-config" class="note-config">
									<label>Note Configuration</label>
									<div class="row">
										<div class="one-half column">
											<label>Note Names</label>
											<textarea id="names" class="u-full-width">C
C#
D
D#
E
F
F#
G
G#
A
A#
B</textarea>
										</div>
										<div class="one-half column">
											<label>Note Colors (hex)</label>
											<textarea id="note_colors" class="u-full-width">55ff55
ff5555
55ff55
ff5555
55ff55
55ff55
ff5555
55ff55
ff5555
55ff55
ff5555
55ff55</textarea>
										</div>
									</div>
									<label>Preview</label>
									<div class="note-buttons">
										<!-- Note buttons will be added dynamically -->
									</div>
								</div>

								<div class="control-group" id="equivStepsGroup" style="display: none;">
									<label id="numberLabel">Steps To Equivalence Interval</label>
									<input id="equivSteps" type="number" min="1" max="999" onchange="changeURL();noPreset();" class="u-full-width">
								</div>

								<div class="control-group" id="fundamentalColorGroup" style="display: none;">
									<label id="fundamental_colorLabel">Fundamental Color</label>
									<input type="text" id="fundamental_color" class="jscolor u-full-width" value="#55ff55">
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="six columns">
							<label for="key-image">Key Image</label>
							<select class="u-full-width" id="key-image" onchange="updateKeyboardDisplay()">
								<option value="none">None</option>
								<option value="hexagon">Hexagon</option>
							</select>
						</div>
						<div class="six columns">
							<label for="text-size">Note Text Size</label>
							<input type="range" id="text-size" min="0.5" max="1.0" step="0.1" value="1.0" onchange="updateKeyboardDisplay()">
						</div>
					</div>
				</div>

				<!-- Advanced Tab -->
				<div id="advanced" class="tab-content">
					<div class="row">
						<div class="column">
							<label>
								<input id="show_intervals" type="checkbox" name="show_intervals" value="fnord" onchange="changeURL();noPreset();">
								<span class="label-body">Show Intervals</span>
							</label>
							<label>
								<input id="show_all_notes" type="checkbox" name="show_all_notes" value="fnord" onchange="changeURL();noPreset();">
								<span class="label-body">Show All Played Notes</span>
							</label>
							<label>Scale (<a href="http://www.huygens-fokker.org/scala/scl_format.html" target="new" style="color: #222; text-decoration: none;">Scala format</a>)</label>
							<textarea id="scale" onchange="changeURL();noPreset();" class="iosscrollable u-full-width" rows="12">! 31-ed2 Bosanquet Wilson Terpstra.scl
! 31-tone equal tempered scale consisting of 31 sonically equal divisions per frequency halving/doubling in standard meantone notation, mapped on a Bosanquet / Wilson / Terpstra layout.
!
Temper | 31-ed2 Bosanquet / Wilson / Terpstra
31
!
38.70968
77.41935
116.12903
154.83871
193.54839
232.25806
270.96774
309.67742
348.38710
387.09677
425.80645
464.51613
503.22581
541.93548
580.64516
619.35484
658.06452
696.77419
735.48387
774.19355
812.90323
851.61290
890.32258
929.03226
967.74194
1006.45161
1045.16129
1083.87097
1122.58065
1161.29032
1200.00000</textarea>
						</div>
					</div>
				</div>

				<!-- Credits Tab -->
				<div id="credits" class="tab-content">
					<div class="row">
						<div class="container" style="text-align:center">
							Hex layout by <a href="http://siementerpstra.com/" target="new">Siemen Terpstra</a> in the late 80s. Early web development by <a href="http://jamesfenn.com/" target="new">James Fenn</a> and <a href="http://brandlew.com/" target="new">Brandon Lewis</a>, <a href="http://whatmusicreallyis.com/" title="What Music Really İs" target="new">Bo Constantinsen</a> and <a href="https://sites.google.com/site/wangchengu/" target="new">Chengu Wang</a>. Current 2024-2025 version created and maintained by Peter Keay @rustopian. Credits to Scott Thompson and <a href="http://ozanyarman.com/" target="new">Dr Ozan Yarman</a> for contributing samples. Current version 2.0 (Jan. 2025), released as Free/Libre and Open Source Software under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="new">GPL-3.0</a>.
						</div>
					</div>
				</div>

				<!-- Learning Tab -->
				<div id="learning" class="tab-content">
					<div class="row">
						<div class="one-half column">
							<div class="learning-controls">
								<label>Learning Functions</label>
								<div class="control-group">
									<label>Select Root Note</label>
									<select id="learning-note-root" class="u-full-width">
										<!-- Note names will be populated dynamically -->
									</select>
								</div>
								<div class="control-group">
									<button type="button" class="button" onclick="window.clearLearningMode()">Clear Learning Mode</button>
								</div>
								<div class="control-group">
									<label>Chords</label>
									<ul id="chord-list">
										<!-- Chords will be populated dynamically -->
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row" style="margin-top: 20px;">
					<input name="Submit" type="submit" value="Save" class="button-primary">
				</div>
			</form>
		</div>
	</div>

	<canvas id="keyboard" tabindex="1" width="1897" height="936" style="display: none; height: 936px; width: 1897px; margin-top: -468px; margin-left: -948.5px;"></canvas>

	<img alt="Return to keyboard design" src="images/back.png" id="backButton" onclick="back()" style="display: none;">

	<button id="release-all" class="release-all-button">Release All</button>
	<button id="settings-button" class="settings-button">Settings</button>

	<div id="chord-display" class="chord-display"></div>

	<script>
		// Add tab functionality
		document.querySelectorAll('.tab-button').forEach(button => {
			button.addEventListener('click', () => {
				// Remove active class from all buttons and content
				document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
				document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
				
				// Add active class to clicked button and corresponding content
				button.classList.add('active');
				document.getElementById(button.dataset.tab)?.classList.add('active');
			});
		});

		// Add font loading check
		document.fonts.ready.then(function() {
			console.log('Fonts loaded:', document.fonts.check('1em "Bravura Text"'));
		});

		// Add font loading check
		document.fonts.ready.then(function() {
			console.log('Ekmelos font loaded:', document.fonts.check('1em "Ekmelos"'));
		});

		// Custom dropdown functionality
		document.addEventListener('DOMContentLoaded', function() {
			const notationSystems = [
				{ value: 'Standard', label: 'Standard', symbols: '\uE27A \uE27B \uE262 \uE260' },
				{ value: 'Sagittal', label: 'Sagittal', symbols: '\uE30A \uE30B \uE318 \uE319' },
				{ value: 'Mixed Sagittal', label: 'Mixed Sagittal', symbols: '\uE30A \uE30B \uE262 \uE260' },
				{ value: 'Stein/Zimmermann', label: 'Stein/Zimmermann', symbols: '\uE282 \uE284 \uE262 \uE260' },
				{ value: 'Stein/Half-Flat', label: 'Stein/Half-Flat', symbols: '\uE282 \uF612 \uE262 \uE260' }
			];

			const select = document.getElementById('notation-system');
			const wrapper = document.createElement('div');
			wrapper.className = 'custom-select-wrapper';
			select.parentNode.insertBefore(wrapper, select);

			const customSelect = document.createElement('div');
			customSelect.className = 'custom-select';
			wrapper.appendChild(customSelect);

			const optionsContainer = document.createElement('div');
			optionsContainer.className = 'custom-select-options';
			wrapper.appendChild(optionsContainer);

			notationSystems.forEach(system => {
				const option = document.createElement('div');
				option.className = 'custom-select-option';
				option.setAttribute('data-value', system.value);
				option.innerHTML = `${system.label}<span class="notation-symbols">(${system.symbols})</span>`;
				optionsContainer.appendChild(option);

				option.addEventListener('click', function() {
					select.value = system.value;
					customSelect.innerHTML = `${system.label}<span class="notation-symbols">(${system.symbols})</span>`;
					optionsContainer.style.display = 'none';
					// Trigger the change event on the original select
					const event = new Event('change');
					select.dispatchEvent(event);
				});
			});

			// Set initial value
			const initialSystem = notationSystems[0];
			customSelect.innerHTML = `${initialSystem.label}<span class="notation-symbols">(${initialSystem.symbols})</span>`;

			// Toggle dropdown
			customSelect.addEventListener('click', function(e) {
				e.stopPropagation();
				const isVisible = optionsContainer.style.display === 'block';
				optionsContainer.style.display = isVisible ? 'none' : 'block';
			});

			// Close dropdown when clicking outside
			document.addEventListener('click', function() {
				optionsContainer.style.display = 'none';
			});
		});
	</script>
</body></html>
